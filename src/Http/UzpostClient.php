<?php/** Abdukodir Khojiyev* Backend Developer* Project: encoderuz/uzpost* Date:  11/03/25*/namespace Encoderuz\Uzpost\Http;use Encoderuz\Uzpost\Exceptions\UzpostException;use GuzzleHttp\Client;use GuzzleHttp\Exception\GuzzleException;class UzpostClient{    protected string $baseUrl;    protected string $apiKey;    protected Client $httpClient;    private array $logs = [];    public function __construct($apiKey, string $baseUrl = 'https://prodapi.pochta.uz/api')    {        $this->httpClient = new Client([            'base_uri' => $baseUrl        ]);        $this->baseUrl = rtrim($baseUrl, '/');;        $this->apiKey = $apiKey;    }    /**     * @throws UzpostException     */    public function send_request(string $method, string $endpoint, array $params = [], string $apiVersion = 'v1'): array    {        try {            $fullEndpoint = "/{$apiVersion}/".ltrim($endpoint, '/');//            print_r($fullEndpoint);exit();            $options = [                'headers' => [                    'Authorization' => 'Bearer '.$this->apiKey,                    'Accept'        => 'application/json',                    'Content-Type'  => 'application/json',                    'Cookie'        => $this->apiKey                ]            ];            if ($method === 'GET') {                $options['query'] = $params;            } else {                $options['json'] = $params;            }            $response = $this->httpClient->request($method, $fullEndpoint, $options);            $data = json_decode($response->getBody()->getContents(), true);            $this->logs[] = [                'timestamp' => date('Y-m-d H:i:s'),                'method'    => $method,                'endpoint'  => $fullEndpoint,                'params'    => $params,                'response'  => $data            ];            return $data;        } catch (GuzzleException $e) {            $this->logs[] = [                'timestamp' => date('Y-m-d H:i:s'),                'method' => $method,                'endpoint' => $fullEndpoint,                'params' => $params,                'error' => $e->getMessage()            ];            throw new UzpostException($e->getMessage(), $e->getCode(), $e);        }    }    public function log(string $filename = 'uzpost_log.txt'): void    {        if (empty($this->logs)) {            return;        }        $logData = '';        foreach ($this->logs as $log) {            $logData .= '['.$log['timestamp'].'] '.$log['method'].' '.$log['endpoint']."\n";            $logData .= 'Params: '.json_encode($log['params'])."\n";            if (isset($log['response'])) {                $logData .= 'Response: '.json_encode($log['response'])."\n";            }            if (isset($log['error'])) {                $logData .= 'Error: '.$log['error']."\n";            }            $logData .= "---------------------------\n";        }        file_put_contents($filename, $logData, FILE_APPEND);        $this->logs = [];    }}