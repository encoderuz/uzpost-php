<?php/** Abdukodir Khojiyev* Backend Developer* Project: uzpost* Date:  13/03/25*/namespace Encoderuz\Uzpost\Http;use Encoderuz\Uzpost\Exceptions\UzpostException;use Encoderuz\Uzpost\Services\CustomerService;class Uzpost{    private static string $token;    private static int $token_expiry = 0;    private static UzpostClient $client;    public function __construct()    {        self::get_client();        self::$client = new UzpostClient();    }    private static function get_client(): UzpostClient    {        if (self::$client === null) {            self::$client = new UzpostClient();        }        return self::$client;    }    /**     * @throws UzpostException     */    public static function get_token(string $username, string $password): self    {        if (self::is_token_valid()) {            return new self();        }        $customer = new CustomerService(self::$client);        $token_request = $customer->authenticate([            'username'    => $username,            'password'    => $password,            'remember_me' => true        ]);        self::$token = $token_request['data']['id_token'];        self::$token_expiry = time() + 79200 /*22 hours*/;        return new self();    }    /**     * @throws UzpostException     */    private function ensure_token_is_valid(): void    {        if (!self::is_token_valid()) {            throw new UzpostException('Expired token.');        }    }    /**     * @throws UzpostException     */    public static function refresh_token(string $username, string $password): void    {        self::get_token($username, $password);    }    private static function is_token_valid(): bool    {        return isset(self::$token) && !empty(self::$token) && time() < self::$token_expiry;    }    /**     * @throws UzpostException     */    public function customer_sign_up(array $customerData)    {        $customer = new CustomerService(self::$client);        return $customer->sign_up($customerData);    }    /**     * @throws UzpostException     */    public function customer_data()    {        $customer = new CustomerService(self::$client);        return $customer->get_customer_data();    }}